geom_jitter() +
labs(x = "Concentration of DNA in ng/µl", y = "Quality of DNA, 260/230",
title = "Assessing quality of DNA with Nanodrop")
ggplot(Nanodrop %>% filter(Quality_260_230 < 60),
aes(x = Nucleic_Acid, y = Quality_260_230)) +
geom_jitter() +
labs(x = "Concentration of DNA in ng/µl", y = "Quality of DNA, 260/230",
title = "Assessing quality of DNA with Nanodrop")
ggplot(Nanodrop %>%
filter(Quality_260_230 < 2.5, Quality_260_230 > 1.8),
aes(x = Nucleic_Acid, y = Quality_260_230)) +
geom_jitter() +
labs(x = "Concentration of DNA in ng/µl", y = "Quality of DNA, 260/230",
title = "Assessing quality of DNA with Nanodrop")
Nanodrop %>%
filter( Quality_260_280 < 2.5,  Quality_260_280 > 1.5 )
#install.packages("optimx", version = "2021-10.12") # this package is required for
#the parasite load package to work
require(devtools)
## install the pacakage of Alice Balard
devtools::install_github("alicebalard/parasiteLoad@v2.0", force = TRUE)
library(dplyr)
library(cowplot)
library(randomForest)
library(ggplot2)
library(VIM) # visualizing missing data
library(mice) # imputing missing data without predictors
library(ggpubr)
library(optimx)
library(rfUtilities) # Implements a permutation test cross-validation for
library(fitdistrplus) #testing distributions
library(logspline)
library(caret)
# read the data
hm <- read.csv("Data/Data_output/imputed_clean_data.csv")
setwd("GitHub/Article_predicting_WL/")
# read the data
hm <- read.csv("Data/Data_output/imputed_clean_data.csv")
# filter for the field mice
Field <- hm %>%
filter(origin == "Field") %>%
drop_na(HI)
# Create vectors for selecting relevant columns
EqPCR.cols      <- c("delta_ct_cewe_MminusE", "MC.Eimeria", "Ct.Eimeria")
Genes_v   <- c("IFNy", "CXCR3", "IL.6", "IL.13", #"IL.10",
"IL1RN","CASP1", "CXCL9", "IDO1", "IRGM1", "MPO",
"MUC2", "MUC5AC", "MYD88", "NCR1", "PRF1", "RETNLB", "SOCS1",
"TICAM1", "TNF") #, "IL.12", "IRG6")
# select the gene columns
gene <-  Field %>%
dplyr::select(c(Mouse_ID, "IFNy", "CXCR3", "IL.6", "IL.13", #"IL.10",
"IL1RN","CASP1", "CXCL9", "IDO1", "IRGM1", "MPO",
"MUC2", "MUC5AC", "MYD88", "NCR1", "PRF1", "RETNLB", "SOCS1",
"TICAM1", "TNF"))
# data frame with only the genes
genes <- gene %>%
dplyr::select(-Mouse_ID)
# load predicting weight loss model
weight_loss_predict <- readRDS("R/Models/predict_WL.rds")
# read the data
hm <- read.csv("Data/Data_output/imputed_clean_data.csv")
# filter for the field mice
Field <- hm %>%
filter(origin == "Field") %>%
drop_na(HI)
library(dplyr)
# read the data
hm <- read.csv("Data/Data_output/imputed_clean_data.csv")
# filter for the field mice
Field <- hm %>%
filter(origin == "Field") %>%
drop_na(HI)
# Create vectors for selecting relevant columns
EqPCR.cols      <- c("delta_ct_cewe_MminusE", "MC.Eimeria", "Ct.Eimeria")
# filter for the field mice
Field <- hm %>%
filter(origin == "Field") %>%
drop_na(HI)
library(tidyr)
# read the data
hm <- read.csv("Data/Data_output/imputed_clean_data.csv")
# filter for the field mice
Field <- hm %>%
filter(origin == "Field") %>%
drop_na(HI)
# Create vectors for selecting relevant columns
EqPCR.cols      <- c("delta_ct_cewe_MminusE", "MC.Eimeria", "Ct.Eimeria")
Genes_v   <- c("IFNy", "CXCR3", "IL.6", "IL.13", #"IL.10",
"IL1RN","CASP1", "CXCL9", "IDO1", "IRGM1", "MPO",
"MUC2", "MUC5AC", "MYD88", "NCR1", "PRF1", "RETNLB", "SOCS1",
"TICAM1", "TNF") #, "IL.12", "IRG6")
# select the gene columns
gene <-  Field %>%
dplyr::select(c(Mouse_ID, "IFNy", "CXCR3", "IL.6", "IL.13", #"IL.10",
"IL1RN","CASP1", "CXCL9", "IDO1", "IRGM1", "MPO",
"MUC2", "MUC5AC", "MYD88", "NCR1", "PRF1", "RETNLB", "SOCS1",
"TICAM1", "TNF"))
# data frame with only the genes
genes <- gene %>%
dplyr::select(-Mouse_ID)
set.seed(540)
# load predicting weight loss model
weight_loss_predict <- readRDS("R/Models/predict_WL.rds")
#The predict() function in R is used to predict the values based on the input data.
predicted_WL <- predict(weight_loss_predict, genes)
# assign test.data to a new object, so that we can make changes
result_field <- genes
#add the new variable of predictions to the result object
result_field <- cbind(result_field, predicted_WL)
# add it to the field data
Field <- cbind(Field, predicted_WL)
rm(gene,genes)
########## Analyzing the distribution of our data in order to
# go on with the anaylsis
Field %>% ggplot(aes(x = predicted_WL)) +
geom_histogram(binwidth = 1.5)
##  predicted WL vs HI
Field %>%
ggplot(aes(x = HI , y = predicted_WL , color = Sex)) +
geom_smooth() +
geom_point()
## body length vs predicted WL
Field %>%
ggplot(aes(x = Body_Length , y = predicted_WL , color = Sex)) +
geom_smooth() +
geom_point()
## Let'S further analyse the distribution of WL
x <- Field$predicted_WL
descdist(data = x, discrete = FALSE)
descdist(data = x, discrete = FALSE, #data is continuous
boot = 1000)
## fitting different distributions
set.seed(10)
n = 25
size = 27
prob = .4
data = rbinom(x, size = size, prob = prob)
fit = fitdist(data = data, dist="binom",
fix.arg=list(size = size),
start=list(prob = 0.1))
summary(fit)
plot(fit)
## ---------------------------------------------------------------------------------------------------
normal_ <- fitdist(x, "norm")
weibull_ <- fitdist(x, "weibull")
gamma_ <- fitdist(x, "gamma")
# Define function to be used to test, get the log lik and aic
tryDistrib <- function(x, distrib){
# deals with fitdistr error:
fit <- tryCatch(MASS::fitdistr(x, distrib), error=function(err) "fit failed")
return(list(fit = fit,
loglik = tryCatch(fit$loglik, error=function(err) "no loglik computed"),
AIC = tryCatch(fit$aic, error=function(err) "no aic computed")))
}
findGoodDist <- function(x, distribs, distribs2){
l =lapply(distribs, function(i) tryDistrib(x, i))
names(l) <- distribs
print(l)
listDistr <- lapply(distribs2, function(i){
if (i %in% "t"){
fitdistrplus::fitdist(x, i, start = list(df =2))
} else {
fitdistrplus::fitdist(x,i)
}}
)
par(mfrow=c(2,2))
denscomp(listDistr, legendtext=distribs2)
cdfcomp(listDistr, legendtext=distribs2)
qqcomp(listDistr, legendtext=distribs2)
ppcomp(listDistr, legendtext=distribs2)
par(mfrow=c(1,1))
}
## ---------------------------------------------------------------------------------------------------
tryDistrib(x, "normal")
tryDistrib(x, "binomial")
tryDistrib(x, "student")
tryDistrib(x, "weibull")
tryDistrib(x, "weibullshifted")
## ---------------------------------------------------------------------------------------------------
findGoodDist(x, "normal", "weibull")
## ----normal-----------------------------------------------------------------------------------------
plot(normal_)
summary(normal_)
plot(gamma_)
summary(gamma_)
plot(weibull_)
summary(weibull_)
## ---------------------------------------------------------------------------------------------------
Field$Sex <- as.factor(Field$Sex)
parasiteLoad::getParamBounds("normal", data = Field, response = "predicted_WL")
speparam <- parasiteLoad::getParamBounds("normal", data = Field, response = "predicted_WL")
##All
fitWL_Sex <- parasiteLoad::analyse(data = Field,
response = "predicted_WL",
model = "normal",
group = "Sex",
myparamBounds = speparam)
##All
fitWL_Sex <- parasiteLoad::analyse(data = Field,
response = "predicted_WL",
model = "normal",
group = "Sex")
##All
fitWL_Sex <- parasiteLoad::analyse(data = Field,
response = "predicted_WL",
model = "normal",
group = "Sex")
Field$predicted_WL
plot_WL_Sex<- bananaPlot(mod = fitWL_Sex$H3,
data = Field,
response = "predicted_WL",
group = "Sex") +
scale_fill_manual(values = c("blueviolet", "limegreen")) +
scale_color_manual(values = c("blueviolet", "limegreen")) +
theme_bw()
plot_WL_Sex
##All
fitWL_Sex <- parasiteLoad::analyse(data = Field,
response = "predicted_WL",
model = "normal",
group = "Sex")
Field$predicted_WL
plot_WL_Sex<- bananaPlot(mod = fitWL_Sex$H3,
data = Field,
response = "predicted_WL",
group = "Sex") +
scale_fill_manual(values = c("blueviolet", "limegreen")) +
scale_color_manual(values = c("blueviolet", "limegreen")) +
theme_bw()
plot_WL_Sex
# Create HI bar
HIgradientBar <- ggplot(data.frame(hi = seq(0,1,0.0001)),
aes(x=hi, y=1, fill = hi)) +
geom_tile() +
theme_void() +
scale_fill_gradient(low = "blue", high = "red")  +
scale_x_continuous(expand=c(.01,0)) +
scale_y_continuous(expand=c(0,0)) +
theme(legend.position = 'none')
plot_grid(plot_WL_Sex,
HIgradientBar,
nrow = 2,
align = "v",
axis = "tlr",
rel_heights = c(13, 1))
plot_WL_Sex
fitWL_Sex <- parasiteLoad::analyse(data = Field,
response = "predicted_WL",
model = "normal",
group = "Sex")
Field$predicted_WL
plot_WL_Sex<- bananaPlot(mod = fitWL_Sex$H3,
data = Field,
response = "predicted_WL",
group = "Sex") +
scale_fill_manual(values = c("blueviolet", "limegreen")) +
scale_color_manual(values = c("blueviolet", "limegreen")) +
theme_bw()
plot_WL_Sex
speparam <- c(L1start = 10.098368660  ,
L1LB = 4.363865741 ,
L1UB = 19.383819138 ,
L2start = 10.098368660  ,
L2LB = 4.363865741 ,
L2UB = 19.383819138  ,
alphaStart = 0, alphaLB = -5, alphaUB = 5,
myshapeStart = 1, myshapeLB = 0.000000001, myshapeUB = 10)
mc_field <- Field %>%
drop_na(MC.Eimeria) %>%
filter(!MC.Eimeria == FALSE)
##All
fitWL_mc <- parasiteLoad::analyse(data = mc_field,
response = "predicted_WL",
model = "normal",
group = "Sex")
plot_WL_MC_eimeria<- bananaPlot(mod = fitWL_mc$H3,
data = mc_field,
response = "predicted_WL",
group = "Sex") +
scale_fill_manual(values = c("blueviolet", "limegreen")) +
scale_color_manual(values = c("blueviolet", "limegreen")) +
theme_bw()
plot_WL_MC_eimeria
#### oocysts
speparam <- c(L1start = 10.098368660  ,
L1LB = 4.363865741 ,
L1UB = 19.383819138 ,
L2start = 10.098368660  ,
L2LB = 4.363865741 ,
L2UB = 19.383819138  ,
alphaStart = 0, alphaLB = -5, alphaUB = 5,
myshapeStart = 1, myshapeLB = 0.000000001, myshapeUB = 10)
mc_field <- Field %>%
drop_na(MC.Eimeria) %>%
filter(!MC.Eimeria == FALSE)
## oocysts
oo_Field <- Field %>%
drop_na(OPG)
##All
fitWL_oo <- parasiteLoad::analyse(data = oo_Field,
response = "predicted_WL",
model = "normal",
group = "Sex")
plot_WL_OOC<- bananaPlot(mod = fitWL_oo$H3,
data = oo_Field,
response = "predicted_WL",
group = "Sex") +
scale_fill_manual(values = c("blueviolet", "limegreen")) +
scale_color_manual(values = c("blueviolet", "limegreen")) +
theme_bw()
plot_WL_MC_eimeria
## Infection according to delta ct
Field_d <- Field %>%
mutate(infected_delta = case_when(
delta_ct_cewe_MminusE > -5 ~ "infected",
delta_ct_cewe_MminusE < -5 ~ "uninfected"
))
Field_d <- Field_d %>%
drop_na(infected_delta)
Field_d$infected_delta <- as.factor(Field_d$infected_delta)
Field_d <- Field_d %>%
filter(!infected_delta == "uninfected")
##All
fitWL_delta <- parasiteLoad::analyse(data = Field_d,
response = "predicted_WL",
model = "normal",
group = "Sex")
plot_WL_delta<- bananaPlot(mod = fitWL_delta$H3,
data = Field_d,
response = "predicted_WL",
group = "Sex") +
scale_fill_manual(values = c("blueviolet", "limegreen")) +
scale_color_manual(values = c("blueviolet", "limegreen")) +
theme_bw()
plot_WL_delta
##  predicted WL vs HI
Field %>%
ggplot(aes(x = HI , y = predicted_WL , color = Sex)) +
geom_smooth() +
geom_point()
dev.off()
##  predicted WL vs HI
Field %>%
ggplot(aes(x = HI , y = predicted_WL , color = Sex)) +
geom_smooth() +
geom_point()
## body length vs predicted WL
Field %>%
ggplot(aes(x = Body_Length , y = predicted_WL , color = Sex)) +
geom_smooth() +
geom_point()
## Let'S further analyse the distribution of WL
x <- Field$predicted_WL
install.packages("optimx", version = "2021-10.12") # this package is required for
install.packages("optimx", version = "2021-10.12")
#install.packages("optimx", version = "2021-10.12") # this package is required for
#the parasite load package to work
require(devtools)
## install the pacakage of Alice Balard
devtools::install_github("alicebalard/parasiteLoad@v2.0", force = TRUE)
library(VIM) # visualizing missing data
library(mice) # imputing missing data without predictors
library(ggpubr)
library(optimx)
library(rfUtilities) # Implements a permutation test cross-validation for
library(fitdistrplus) #testing distributions
library(logspline)
library(caret)
library(dplyr)
library(tidyr)
# read the data
hm <- read.csv("Data/Data_output/imputed_clean_data.csv")
# filter for the field mice
Field <- hm %>%
filter(origin == "Field") %>%
drop_na(HI)
# Create vectors for selecting relevant columns
EqPCR.cols      <- c("delta_ct_cewe_MminusE", "MC.Eimeria", "Ct.Eimeria")
Genes_v   <- c("IFNy", "CXCR3", "IL.6", "IL.13", #"IL.10",
"IL1RN","CASP1", "CXCL9", "IDO1", "IRGM1", "MPO",
"MUC2", "MUC5AC", "MYD88", "NCR1", "PRF1", "RETNLB", "SOCS1",
"TICAM1", "TNF") #, "IL.12", "IRG6")
# select the gene columns
gene <-  Field %>%
dplyr::select(c(Mouse_ID, "IFNy", "CXCR3", "IL.6", "IL.13", #"IL.10",
"IL1RN","CASP1", "CXCL9", "IDO1", "IRGM1", "MPO",
"MUC2", "MUC5AC", "MYD88", "NCR1", "PRF1", "RETNLB", "SOCS1",
"TICAM1", "TNF"))
# data frame with only the genes
genes <- gene %>%
dplyr::select(-Mouse_ID)
# load predicting weight loss model
weight_loss_predict <- readRDS("R/Models/predict_WL.rds")
set.seed(540)
#The predict() function in R is used to predict the values based on the input data.
predicted_WL <- predict(weight_loss_predict, genes)
# assign test.data to a new object, so that we can make changes
result_field <- genes
#add the new variable of predictions to the result object
result_field <- cbind(result_field, predicted_WL)
# add it to the field data
Field <- cbind(Field, predicted_WL)
rm(gene,genes)
########## Analyzing the distribution of our data in order to
# go on with the anaylsis
Field %>% ggplot(aes(x = predicted_WL)) +
geom_histogram(binwidth = 1.5)
##  predicted WL vs HI
Field %>%
ggplot(aes(x = HI , y = predicted_WL , color = Sex)) +
geom_smooth() +
geom_point()
## body length vs predicted WL
Field %>%
ggplot(aes(x = Body_Length , y = predicted_WL , color = Sex)) +
geom_smooth() +
geom_point()
## Let'S further analyse the distribution of WL
x <- Field$predicted_WL
descdist(data = x, discrete = FALSE)
descdist(data = x, discrete = FALSE, #data is continuous
boot = 1000)
## fitting different distributions
set.seed(10)
n = 25
size = 27
prob = .4
data = rbinom(x, size = size, prob = prob)
fit = fitdist(data = data, dist="binom",
fix.arg=list(size = size),
start=list(prob = 0.1))
summary(fit)
plot(fit)
## ---------------------------------------------------------------------------------------------------
normal_ <- fitdist(x, "norm")
weibull_ <- fitdist(x, "weibull")
gamma_ <- fitdist(x, "gamma")
# Define function to be used to test, get the log lik and aic
tryDistrib <- function(x, distrib){
# deals with fitdistr error:
fit <- tryCatch(MASS::fitdistr(x, distrib), error=function(err) "fit failed")
return(list(fit = fit,
loglik = tryCatch(fit$loglik, error=function(err) "no loglik computed"),
AIC = tryCatch(fit$aic, error=function(err) "no aic computed")))
}
findGoodDist <- function(x, distribs, distribs2){
l =lapply(distribs, function(i) tryDistrib(x, i))
names(l) <- distribs
print(l)
listDistr <- lapply(distribs2, function(i){
if (i %in% "t"){
fitdistrplus::fitdist(x, i, start = list(df =2))
} else {
fitdistrplus::fitdist(x,i)
}}
)
par(mfrow=c(2,2))
denscomp(listDistr, legendtext=distribs2)
cdfcomp(listDistr, legendtext=distribs2)
qqcomp(listDistr, legendtext=distribs2)
ppcomp(listDistr, legendtext=distribs2)
par(mfrow=c(1,1))
}
## ---------------------------------------------------------------------------------------------------
tryDistrib(x, "normal")
tryDistrib(x, "binomial")
tryDistrib(x, "student")
tryDistrib(x, "weibull")
tryDistrib(x, "weibullshifted")
## ---------------------------------------------------------------------------------------------------
findGoodDist(x, "normal", "weibull")
## ----normal-----------------------------------------------------------------------------------------
plot(normal_)
summary(normal_)
plot(gamma_)
summary(gamma_)
plot(weibull_)
summary(weibull_)
## ---------------------------------------------------------------------------------------------------
Field$Sex <- as.factor(Field$Sex)
speparam <- parasiteLoad::getParamBounds("normal", data = Field, response = "predicted_WL")
##All
fitWL_Sex <- parasiteLoad::analyse(data = Field,
response = "predicted_WL",
model = "normal",
group = "Sex")
##All
fitWL_Sex <- parasiteLoad::analyse(data = Field,
response = "predicted_WL",
model = "normal",
group = "Sex")
##All
fitWL_Sex <- parasiteLoad::analyse(data = Field,
response = "predicted_WL",
model = "normal",
group = "Sex",
myparamBounds = speparam)
speparam <- parasiteLoad::getParamBounds("normal", data = Field, response = "predicted_WL")
parasiteLoad::getParamBounds("normal", data = Field, response = "predicted_WL")
speparam <- c(L1start = 9.974613425    ,
L1LB = 4.344238065  ,
L1UB = 16.996984668   ,
L2start = 9.974613425    ,
L2LB = 4.344238065  ,
L2UB = 16.996984668    ,
alphaStart = 0, alphaLB = -5, alphaUB = 5,
myshapeStart = 1, myshapeLB = 0.000000001, myshapeUB = 10)
##All
fitWL_Sex <- parasiteLoad::analyse(data = Field,
response = "predicted_WL",
model = "normal",
group = "Sex")
